version: '3.8'

services:
  # 后端 API 服务
  backend:
    build: 
      context: .
      dockerfile: Dockerfile
    container_name: neuro-backend
    ports:
      - "8000:8000"
    # 将数据库文件挂载到宿主机，防止重启丢失数据
    volumes:
      - ./database.db:/app/database.db
    networks:
      - neuro-network
    restart: always
    healthcheck:
      # 使用 Python 原生库检查健康接口，无需安装 curl
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health')"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 5s

  # 爬虫服务 (预留位置)
  # 未来当你构建好爬虫镜像后，可以取消注释并配置
  # crawler:
  #   # 如果爬虫代码在另一个文件夹，可以使用 build context
  #   # build: ../neuro-crawler 
  #   # 或者直接使用构建好的镜像
  #   # image: my-crawler:latest
  #   container_name: neuro-crawler
  #   networks:
  #     - neuro-network
  #   environment:
  #     # 在 Docker 网络内部，可以通过服务名 'backend' 直接访问
  #     - API_BASE_URL=http://backend:8000
  #   depends_on:
  #     backend:
  #       condition: service_healthy
  #   restart: on-failure

networks:
  neuro-network:
    driver: bridge
